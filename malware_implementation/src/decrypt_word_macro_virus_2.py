with open("malware/word_macro_virus_2.bas", encoding='utf-8') as word_macro_virus:
    word_macro_virus_code = word_macro_virus.read().split('\n')

word_macro_virus_encrypted_code = word_macro_virus_code[17:39]
word_macro_virus_decrypted_code = []

for encrypted_line in word_macro_virus_encrypted_code:
    key = ord(encrypted_line[1]) ^ 39
    decrypted_line = ''.join(map(lambda ch: chr(ord(ch) ^ key), encrypted_line[2:]))
    word_macro_virus_decrypted_code.append(decrypted_line)

with open("malware/word_macro_virus_2_decrypted.bas", 'w', encoding='utf-8') as word_macro_virus_decrypted:
    word_macro_virus_decrypted.write(
        'Private Sub Document_Close()\n'
        + '\n'.join(word_macro_virus_decrypted_code) + '\n'
        + 'End Sub'
    )
